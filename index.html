<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a472a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="Pau's World of Wonder ‚Äî Descubr√≠ la naturaleza, saboreando las palabras">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <title>Pau's World of Wonder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

  <style>
    /* ========================================
       CSS CUSTOM PROPERTIES
       ======================================== */
    :root {
      --green-deep: #1a472a;
      --green-mid: #2d6a4f;
      --green-light: #40916c;
      --green-pale: #b7e4c7;
      --cream: #f5f0e8;
      --cream-dark: #e8e0d0;
      --gold: #c9a227;
      --gold-light: #dbb945;
      --gold-pale: #f0e6c0;
      --red-soft: #c0392b;
      --red-glow: rgba(192, 57, 43, 0.15);
      --green-correct: #27ae60;
      --green-glow: rgba(39, 174, 96, 0.15);
      --text-dark: #2c2c2c;
      --text-mid: #5a5a5a;
      --text-light: #8a8a7a;
      --shadow-sm: 0 2px 8px rgba(26, 71, 42, 0.08);
      --shadow-md: 0 4px 20px rgba(26, 71, 42, 0.12);
      --shadow-lg: 0 8px 40px rgba(26, 71, 42, 0.18);
      --radius-sm: 8px;
      --radius-md: 14px;
      --radius-lg: 20px;
      --font-display: 'Cinzel Decorative', serif;
      --font-heading: 'Playfair Display', serif;
      --font-body: 'Cormorant Garamond', serif;
      --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ========================================
       RESET & BASE
       ======================================== */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-body);
      font-size: 1.1rem;
      font-weight: 400;
      line-height: 1.6;
      color: var(--text-dark);
      background-color: var(--cream);
      min-height: 100dvh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* Paper grain texture */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* ========================================
       APP CONTAINER
       ======================================== */
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100dvh;
      position: relative;
    }

    /* ========================================
       SCREEN SYSTEM
       ======================================== */
    .screen {
      display: none;
      padding: 2rem 1.5rem;
      min-height: 100dvh;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity 0.5s var(--transition-smooth),
                  transform 0.5s var(--transition-smooth);
    }

    .screen.active {
      display: flex;
      flex-direction: column;
      opacity: 1;
      transform: translateY(0);
    }

    /* Fade-in animation for newly activated screens */
    @keyframes screenIn {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .screen.active {
      animation: screenIn 0.6s var(--transition-smooth) forwards;
    }

    /* ========================================
       BOTANICAL ORNAMENT (decorative leaf line)
       ======================================== */
    .ornament {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      margin: 1.5rem 0;
      color: var(--green-light);
      font-size: 0.85rem;
      letter-spacing: 0.3em;
      user-select: none;
    }

    .ornament::before,
    .ornament::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--green-pale), transparent);
    }

    /* ========================================
       BUTTONS
       ======================================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.9rem 2rem;
      min-height: 48px;
      border: none;
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 1.15rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: all 0.3s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: var(--green-deep);
      color: var(--cream);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover,
    .btn-primary:active {
      background: var(--green-mid);
      box-shadow: var(--shadow-lg);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: transparent;
      color: var(--green-deep);
      border: 2px solid var(--green-deep);
    }

    .btn-secondary:hover,
    .btn-secondary:active {
      background: var(--green-deep);
      color: var(--cream);
    }

    .btn-gold {
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      color: var(--green-deep);
      box-shadow: var(--shadow-md);
      font-weight: 700;
    }

    .btn-gold:hover,
    .btn-gold:active {
      box-shadow: var(--shadow-lg);
      transform: translateY(-1px);
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-block {
      width: 100%;
    }

    /* ========================================
       SCREEN 1: WELCOME
       ======================================== */
    #screen-welcome {
      align-items: center;
      justify-content: center;
      text-align: center;
      padding-top: 3rem;
      padding-bottom: 3rem;
    }

    .welcome-flora {
      font-size: 2.5rem;
      line-height: 1;
      margin-bottom: 0.5rem;
      letter-spacing: 0.3em;
      filter: saturate(0.85);
      animation: floraFloat 4s ease-in-out infinite;
    }

    @keyframes floraFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .welcome-title {
      font-family: var(--font-display);
      font-size: 1.85rem;
      font-weight: 700;
      color: var(--green-deep);
      line-height: 1.25;
      margin-bottom: 0.25rem;
      letter-spacing: 0.04em;
    }

    .welcome-title-accent {
      display: block;
      font-family: var(--font-heading);
      font-style: italic;
      font-weight: 400;
      font-size: 1.3rem;
      color: var(--gold);
      letter-spacing: 0.06em;
      margin-top: 0.3rem;
    }

    .welcome-subtitle {
      font-family: var(--font-body);
      font-size: 1.15rem;
      font-weight: 400;
      font-style: italic;
      color: var(--text-mid);
      margin-top: 1rem;
      max-width: 300px;
      line-height: 1.5;
    }

    .welcome-decoration {
      margin: 2rem 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      color: var(--green-pale);
    }

    .welcome-leaf {
      font-size: 1.6rem;
      opacity: 0.7;
      animation: leafSway 3s ease-in-out infinite;
    }

    .welcome-leaf:nth-child(2) {
      animation-delay: 0.5s;
    }

    .welcome-leaf:nth-child(3) {
      animation-delay: 1s;
    }

    @keyframes leafSway {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(5deg); }
      75% { transform: rotate(-5deg); }
    }

    .welcome-border {
      position: relative;
      padding: 2.5rem 2rem;
      margin: 0 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .welcome-border::before {
      content: '';
      position: absolute;
      inset: 0;
      border: 1.5px solid var(--green-pale);
      border-radius: var(--radius-lg);
      opacity: 0.6;
      pointer-events: none;
    }

    .welcome-border::after {
      content: '';
      position: absolute;
      inset: 4px;
      border: 1px solid var(--gold-pale);
      pointer-events: none;
      border-radius: calc(var(--radius-lg) - 2px);
      opacity: 0.4;
    }

    /* Admin access button */
    .admin-access-btn {
      margin-top: 2rem;
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.06);
      font-size: 0.9rem;
      cursor: pointer;
      opacity: 0.3;
      transition: all 0.3s;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      align-self: center;
    }

    .admin-access-btn:hover,
    .admin-access-btn:active {
      opacity: 0.7;
      background: rgba(0, 0, 0, 0.1);
    }

    /* ========================================
       SCREEN 2: CATEGORY SELECT
       ======================================== */
    #screen-category {
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .category-heading {
      font-family: var(--font-heading);
      font-size: 1.6rem;
      color: var(--green-deep);
      margin-bottom: 0.5rem;
    }

    .category-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      width: 100%;
      margin-top: 1.5rem;
    }

    .category-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 2rem 1rem;
      background: white;
      border: 2px solid var(--cream-dark);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.35s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      position: relative;
      overflow: hidden;
    }

    .category-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--green-deep), var(--green-mid));
      opacity: 0;
      transition: opacity 0.35s var(--transition-smooth);
    }

    .category-card:hover,
    .category-card:active {
      border-color: var(--green-deep);
      box-shadow: var(--shadow-lg);
      transform: translateY(-3px);
    }

    .category-card:active {
      transform: translateY(-1px);
    }

    .category-card:hover::before,
    .category-card:active::before {
      opacity: 1;
    }

    .category-card > * {
      position: relative;
      z-index: 1;
    }

    .category-card:hover .category-icon,
    .category-card:active .category-icon {
      transform: scale(1.15);
    }

    .category-card:hover .category-label,
    .category-card:active .category-label {
      color: var(--cream);
    }

    .category-card:hover .category-sub,
    .category-card:active .category-sub {
      color: var(--green-pale);
    }

    .category-icon {
      font-size: 3rem;
      line-height: 1;
      transition: transform 0.35s var(--transition-smooth);
      filter: saturate(0.9);
    }

    .category-label {
      font-family: var(--font-heading);
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--green-deep);
      transition: color 0.35s var(--transition-smooth);
    }

    .category-sub {
      font-size: 0.85rem;
      color: var(--text-light);
      font-style: italic;
      transition: color 0.35s var(--transition-smooth);
    }

    /* ========================================
       SCREEN 3: QUIZ
       ======================================== */
    #screen-quiz {
      padding-top: 1.25rem;
      gap: 0;
    }

    /* Progress bar */
    .progress-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }

    .progress-text {
      font-family: var(--font-body);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-mid);
      white-space: nowrap;
      min-width: fit-content;
    }

    .progress-bar {
      flex: 1;
      height: 6px;
      background: var(--cream-dark);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--green-deep), var(--green-light));
      border-radius: 3px;
      transition: width 0.5s var(--transition-smooth);
      width: 10%;
    }

    .score-tracker {
      font-family: var(--font-body);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--gold);
      white-space: nowrap;
    }

    /* Photo */
    .photo-container {
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: var(--cream-dark);
      box-shadow: var(--shadow-md);
      margin-bottom: 1.25rem;
      position: relative;
    }

    .photo-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      display: block;
      transition: opacity 0.5s ease;
    }

    .photo-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      color: var(--text-light);
      font-style: italic;
    }

    .photo-placeholder-icon {
      font-size: 2.5rem;
      opacity: 0.5;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.8; }
    }

    /* Question */
    .question-text {
      font-family: var(--font-heading);
      font-size: 1.3rem;
      color: var(--green-deep);
      text-align: center;
      margin-bottom: 1rem;
    }

    /* Options */
    .options-grid {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-bottom: 1.25rem;
    }

    .option-btn {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      width: 100%;
      min-height: 52px;
      padding: 0.75rem 1rem;
      background: white;
      border: 2px solid var(--cream-dark);
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 1.05rem;
      font-weight: 500;
      color: var(--text-dark);
      cursor: pointer;
      transition: all 0.25s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      text-align: left;
    }

    .option-btn:hover:not(:disabled) {
      border-color: var(--green-mid);
      background: rgba(45, 106, 79, 0.04);
      transform: translateX(4px);
    }

    .option-btn:active:not(:disabled) {
      transform: translateX(2px);
    }

    .option-btn .option-letter {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--cream-dark);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-mid);
      flex-shrink: 0;
      transition: all 0.25s var(--transition-smooth);
    }

    .option-btn .option-content {
      flex: 1;
    }

    .option-btn .option-name {
      display: block;
      line-height: 1.3;
    }

    .option-btn .option-scientific {
      display: block;
      font-size: 0.8rem;
      font-style: italic;
      color: var(--text-light);
      margin-top: 2px;
    }

    /* Option states */
    .option-btn.correct {
      border-color: var(--green-correct);
      background: var(--green-glow);
      box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.12);
    }

    .option-btn.correct .option-letter {
      background: var(--green-correct);
      color: white;
    }

    .option-btn.wrong {
      border-color: var(--red-soft);
      background: var(--red-glow);
      box-shadow: 0 0 0 3px rgba(192, 57, 43, 0.1);
    }

    .option-btn.wrong .option-letter {
      background: var(--red-soft);
      color: white;
    }

    .option-btn:disabled {
      cursor: default;
      opacity: 0.6;
      transform: none !important;
    }

    .option-btn.correct:disabled,
    .option-btn.wrong:disabled {
      opacity: 1;
    }

    /* Reveal section */
    .reveal-section {
      display: none;
      animation: slideUp 0.4s var(--transition-smooth) forwards;
    }

    .reveal-section.visible {
      display: block;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fun-fact-card {
      background: white;
      border-left: 3px solid var(--gold);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      padding: 1rem 1.25rem;
      margin-bottom: 1.25rem;
    }

    .fun-fact-label {
      font-family: var(--font-body);
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--gold);
      margin-bottom: 0.35rem;
    }

    .fun-fact-text {
      font-size: 1rem;
      color: var(--text-mid);
      line-height: 1.55;
    }

    .fun-fact-species {
      font-family: var(--font-heading);
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--green-deep);
      margin-bottom: 0.25rem;
    }

    .fun-fact-species-en {
      font-size: 0.85rem;
      font-style: italic;
      color: var(--text-light);
      margin-bottom: 0.5rem;
    }

    /* Quote section */
    .quote-section {
      display: none;
      animation: slideUp 0.5s var(--transition-smooth) forwards;
    }

    .quote-section.visible {
      display: block;
    }

    .quote-divider {
      width: 40px;
      height: 2px;
      background: var(--gold);
      margin: 0 auto 1.5rem;
      border-radius: 1px;
    }

    .quote-block {
      position: relative;
      padding: 1.75rem 1.5rem;
      margin-bottom: 1.25rem;
      text-align: center;
    }

    .quote-block::before {
      content: '\201C';
      position: absolute;
      top: -0.15rem;
      left: 0.25rem;
      font-family: var(--font-heading);
      font-size: 4.5rem;
      color: var(--green-pale);
      line-height: 1;
      opacity: 0.5;
      pointer-events: none;
    }

    .quote-block::after {
      content: '\201D';
      position: absolute;
      bottom: -1.5rem;
      right: 0.25rem;
      font-family: var(--font-heading);
      font-size: 4.5rem;
      color: var(--green-pale);
      line-height: 1;
      opacity: 0.5;
      pointer-events: none;
    }

    .quote-text {
      font-family: var(--font-heading);
      font-style: italic;
      font-size: 1.2rem;
      line-height: 1.55;
      color: var(--green-deep);
      position: relative;
      z-index: 1;
    }

    .quote-author {
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--gold);
      margin-top: 0.75rem;
      letter-spacing: 0.03em;
    }

    /* Next round button */
    .next-section {
      margin-top: 0.5rem;
      padding-bottom: 1rem;
    }

    /* ========================================
       SCREEN 4: RESULTS
       ======================================== */
    #screen-results {
      align-items: center;
      text-align: center;
      padding-top: 2rem;
    }

    .results-header {
      font-family: var(--font-display);
      font-size: 1.3rem;
      color: var(--green-deep);
      letter-spacing: 0.04em;
      margin-bottom: 1.5rem;
    }

    /* Share card (designed for screenshot) */
    #share-card {
      width: 100%;
      background: white;
      border-radius: var(--radius-lg);
      padding: 2rem 1.5rem;
      box-shadow: var(--shadow-md);
      border: 1.5px solid var(--cream-dark);
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    #share-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--green-deep), var(--gold), var(--green-deep));
    }

    .share-card-title {
      font-family: var(--font-display);
      font-size: 1rem;
      color: var(--green-deep);
      letter-spacing: 0.06em;
      margin-bottom: 0.25rem;
      margin-top: 0.5rem;
    }

    .share-card-category {
      font-family: var(--font-body);
      font-size: 0.85rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 1.5rem;
    }

    .score-big {
      font-family: var(--font-display);
      font-size: 3.5rem;
      font-weight: 700;
      color: var(--green-deep);
      line-height: 1;
    }

    .score-big span {
      font-size: 1.8rem;
      color: var(--text-light);
      font-weight: 400;
    }

    .score-label {
      font-family: var(--font-body);
      font-size: 1rem;
      color: var(--text-mid);
      margin-top: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .score-message {
      font-family: var(--font-heading);
      font-style: italic;
      font-size: 1.15rem;
      color: var(--gold);
      margin-bottom: 1.5rem;
    }

    .results-divider {
      width: 50px;
      height: 1px;
      background: var(--cream-dark);
      margin: 0 auto 1.25rem;
    }

    /* Result buttons */
    .results-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      width: 100%;
    }

    .results-share-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .share-icon {
      margin-right: 0.4rem;
    }

    /* ========================================
       CONFETTI ANIMATION (for high scores)
       ======================================== */
    @keyframes confettiFall {
      0% {
        transform: translateY(-10vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      top: 0;
      width: 10px;
      height: 10px;
      border-radius: 2px;
      pointer-events: none;
      z-index: 9998;
      animation: confettiFall 3s ease-in forwards;
    }

    /* ========================================
       LOADING STATE
       ======================================== */
    .loading-shimmer {
      background: linear-gradient(90deg, var(--cream-dark) 25%, var(--cream) 50%, var(--cream-dark) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s ease-in-out infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* ========================================
       RESPONSIVE ADJUSTMENTS
       ======================================== */
    @media (max-width: 360px) {
      .welcome-title {
        font-size: 1.55rem;
      }

      .category-cards {
        gap: 0.75rem;
      }

      .category-card {
        padding: 1.5rem 0.75rem;
      }

      .score-big {
        font-size: 2.8rem;
      }
    }

    @media (min-width: 481px) {
      .app {
        padding: 0 1rem;
      }
    }

    /* ========================================
       UTILITY CLASSES
       ======================================== */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mt-1 { margin-top: 0.5rem; }
    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }
    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }

    /* ========================================
       PLAYER NAME INPUT
       ======================================== */
    .player-name-group {
      width: 100%;
      margin-bottom: 1.5rem;
    }

    .player-name-label {
      display: block;
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text-mid);
      margin-bottom: 0.4rem;
      text-align: center;
    }

    .player-name-input {
      width: 100%;
      padding: 0.7rem 1rem;
      border: 1.5px solid var(--cream-dark);
      border-radius: var(--radius-sm);
      font-family: var(--font-body);
      font-size: 1.1rem;
      color: var(--text-dark);
      background: white;
      text-align: center;
      transition: border-color 0.2s;
    }

    .player-name-input:focus {
      outline: none;
      border-color: var(--green-light);
    }

    .player-name-input::placeholder {
      color: var(--text-light);
      font-style: italic;
    }

    /* ========================================
       HELP BUTTON
       ======================================== */
    .question-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .question-row .question-text {
      margin-bottom: 0;
    }

    .help-btn {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.35rem 0.65rem;
      background: var(--gold-pale);
      border: 1.5px solid var(--gold);
      border-radius: var(--radius-sm);
      font-family: var(--font-body);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--green-deep);
      cursor: pointer;
      transition: all 0.2s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .help-btn:hover:not(:disabled) {
      background: var(--gold);
      color: white;
    }

    .help-btn:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      background: var(--cream-dark);
      border-color: var(--cream-dark);
    }

    .help-icon {
      font-size: 0.9rem;
    }

    .option-btn.eliminated {
      opacity: 0.25;
      text-decoration: line-through;
      pointer-events: none;
      transform: scale(0.97);
    }

    /* ========================================
       BIRD SOUND BAR
       ======================================== */
    .bird-sound-bar {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.75rem;
      background: var(--green-pale);
      border-radius: var(--radius-sm);
      margin-bottom: 0.75rem;
    }

    .sound-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: var(--green-deep);
      color: white;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.2s;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      flex-shrink: 0;
    }

    .sound-btn:hover {
      background: var(--green-mid);
      transform: scale(1.1);
    }

    .sound-btn.playing {
      animation: pulse-sound 1s ease-in-out infinite;
    }

    @keyframes pulse-sound {
      0%, 100% { box-shadow: 0 0 0 0 rgba(26, 71, 42, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(26, 71, 42, 0); }
    }

    .sound-label {
      font-family: var(--font-body);
      font-size: 0.8rem;
      color: var(--green-deep);
      font-style: italic;
    }

    /* ========================================
       WORLD MAP
       ======================================== */
    .map-container {
      background: white;
      border-radius: var(--radius-sm);
      padding: 0.75rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow-sm);
    }

    .map-label {
      font-family: var(--font-body);
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--gold);
      margin-bottom: 0.4rem;
      text-align: center;
    }

    .world-map {
      width: 100%;
      max-height: 140px;
    }

    .map-land {
      fill: var(--cream-dark);
      stroke: var(--green-pale);
      stroke-width: 0.3;
    }

    .map-highlight {
      fill: var(--green-light);
      opacity: 0.7;
    }

    .map-dot {
      fill: var(--red-soft);
      stroke: white;
      stroke-width: 1;
    }

    /* ========================================
       REPORT SCREEN
       ======================================== */
    .report-content {
      width: 100%;
    }

    .report-card {
      background: white;
      border-radius: var(--radius-md);
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      box-shadow: var(--shadow-sm);
      border-left: 3px solid var(--green-deep);
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .report-card-player {
      font-family: var(--font-heading);
      font-weight: 700;
      font-size: 1rem;
      color: var(--green-deep);
    }

    .report-card-date {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .report-card-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--text-mid);
    }

    .report-stat {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .report-stat-value {
      font-weight: 600;
      color: var(--green-deep);
    }

    .report-card-detail {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-light);
      font-style: italic;
    }

    .report-toggle-btn {
      display: block;
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.35rem;
      background: none;
      border: none;
      border-top: 1px solid var(--cream-dark);
      font-family: var(--font-body);
      font-size: 0.8rem;
      color: var(--green-light);
      cursor: pointer;
      transition: color 0.2s;
    }

    .report-toggle-btn:hover {
      color: var(--green-deep);
    }

    .report-details-wrapper {
      display: none;
      margin-top: 0.5rem;
    }

    .report-details-wrapper.visible {
      display: block;
      animation: slideUp 0.3s var(--transition-smooth) forwards;
    }

    .report-rounds-detail {
      font-size: 0.82rem;
      color: var(--text-mid);
    }

    .report-detail-section {
      margin-bottom: 0.75rem;
    }

    .report-detail-title {
      display: block;
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--gold);
      margin-bottom: 0.3rem;
      padding-bottom: 0.2rem;
      border-bottom: 1px solid var(--cream-dark);
    }

    .report-round-item {
      padding: 0.25rem 0;
      line-height: 1.4;
      border-bottom: 1px dotted var(--cream-dark);
    }

    .report-round-item:last-child {
      border-bottom: none;
    }

    /* ========================================
       REPORT TABS
       ======================================== */
    .report-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 1.25rem;
      background: white;
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      border: 1.5px solid var(--cream-dark);
    }

    .report-tab {
      flex: 1;
      padding: 0.6rem 0.25rem;
      background: none;
      border: none;
      font-family: var(--font-body);
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.25s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }

    .report-tab::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 10%;
      width: 80%;
      height: 2.5px;
      background: var(--green-deep);
      border-radius: 2px;
      transform: scaleX(0);
      transition: transform 0.3s var(--transition-smooth);
    }

    .report-tab.active {
      color: var(--green-deep);
      background: var(--green-pale);
    }

    .report-tab.active::after {
      transform: scaleX(1);
    }

    .report-tab:not(.active):hover {
      color: var(--green-mid);
      background: rgba(183, 228, 199, 0.2);
    }

    .report-tab-content {
      display: none;
    }

    .report-tab-content.active {
      display: block;
      animation: screenIn 0.4s var(--transition-smooth) forwards;
    }

    /* ========================================
       STATISTICS SECTION
       ======================================== */
    .stats-section {
      margin-bottom: 1.5rem;
    }

    .stats-section-title {
      font-family: var(--font-heading);
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--green-deep);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .stats-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: white;
      padding: 0.6rem 0.9rem;
      border-radius: var(--radius-sm);
      margin-bottom: 0.4rem;
      box-shadow: var(--shadow-sm);
      transition: transform 0.2s;
    }

    .stats-item:hover {
      transform: translateX(3px);
    }

    .stats-rank {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--gold);
      min-width: 24px;
      text-align: center;
    }

    .stats-rank.gold { color: #c9a227; }
    .stats-rank.silver { color: #9ca3af; }
    .stats-rank.bronze { color: #b87333; }

    .stats-info {
      flex: 1;
      min-width: 0;
    }

    .stats-name {
      font-family: var(--font-heading);
      font-weight: 600;
      font-size: 0.92rem;
      color: var(--text-dark);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .stats-detail {
      font-size: 0.75rem;
      color: var(--text-light);
      font-style: italic;
    }

    .stats-badge {
      font-size: 0.82rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      white-space: nowrap;
    }

    .stats-badge.positive {
      background: var(--green-glow);
      color: var(--green-correct);
    }

    .stats-badge.negative {
      background: var(--red-glow);
      color: var(--red-soft);
    }

    .stats-badge.neutral {
      background: var(--gold-pale);
      color: var(--gold);
    }

    .stats-bar-container {
      width: 60px;
      height: 6px;
      background: var(--cream-dark);
      border-radius: 3px;
      overflow: hidden;
    }

    .stats-bar-fill {
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--green-deep), var(--green-light));
      transition: width 0.5s var(--transition-smooth);
    }

    .stats-bar-fill.low {
      background: linear-gradient(90deg, var(--red-soft), #e74c3c);
    }

    .stats-empty {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-light);
      font-style: italic;
    }

    /* ========================================
       QUIT BUTTON & OVERLAY
       ======================================== */
    .quiz-top-bar {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .quit-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border: 1.5px solid var(--cream-dark);
      border-radius: 50%;
      background: white;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .quit-btn:hover {
      border-color: var(--red-soft);
      color: var(--red-soft);
      background: var(--red-glow);
    }

    .quit-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9000;
      background: rgba(26, 71, 42, 0.6);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .quit-overlay.visible {
      display: flex;
      animation: fadeIn 0.25s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .quit-dialog {
      background: white;
      border-radius: var(--radius-lg);
      padding: 2rem 1.75rem;
      max-width: 320px;
      width: 100%;
      text-align: center;
      box-shadow: var(--shadow-lg);
      animation: dialogIn 0.3s var(--transition-smooth);
    }

    @keyframes dialogIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .quit-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .quit-title {
      font-family: var(--font-heading);
      font-size: 1.2rem;
      color: var(--green-deep);
      margin-bottom: 0.5rem;
    }

    .quit-text {
      font-size: 0.9rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 1.5rem;
    }

    .quit-actions {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .quit-actions .btn {
      font-size: 1rem;
    }

    /* ========================================
       BACKGROUND MUSIC ‚Äî mute button (trees quiz)
       ======================================== */
    .music-mute-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border: 1.5px solid var(--cream-dark);
      border-radius: 50%;
      background: white;
      color: var(--green-mid);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s var(--transition-smooth);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      margin-left: auto;
    }

    .music-mute-btn:hover {
      border-color: var(--green-mid);
      background: var(--green-pale);
    }

    .music-mute-btn.muted {
      color: var(--text-light);
      opacity: 0.5;
    }

    /* Music toggle hint on category card */
    .music-hint {
      font-size: 0.72rem;
      color: var(--text-light);
      margin-top: 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* ========================================
       OFFSCREEN CANVAS (for share image)
       ======================================== */
    #share-canvas {
      position: absolute;
      left: -9999px;
      top: -9999px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- ============ SCREEN 1: WELCOME ============ -->
    <section id="screen-welcome" class="screen active">
      <div class="welcome-border">
        <div class="welcome-flora">üåø ü¶ú üå≥</div>

        <h1 class="welcome-title">
          Pau's World
          <span class="welcome-title-accent">of Wonder</span>
        </h1>

        <div class="ornament">‚ú¶</div>

        <p class="welcome-subtitle">
          Descubr√≠ la naturaleza, saboreando las palabras
        </p>

        <div class="welcome-decoration">
          <span class="welcome-leaf">üçÉ</span>
          <span class="welcome-leaf">üå±</span>
          <span class="welcome-leaf">üçÇ</span>
        </div>

        <div class="player-name-group">
          <label for="player-name" class="player-name-label">¬øC√≥mo te llam√°s?</label>
          <input type="text" id="player-name" class="player-name-input" placeholder="Tu nombre" maxlength="30" autocomplete="off">
        </div>

        <button id="btn-start" class="btn btn-primary btn-block">
          Comenzar
        </button>
      </div>

    </section>

    <!-- ============ SCREEN 2: CATEGORY SELECT ============ -->
    <section id="screen-category" class="screen">
      <h2 class="category-heading">¬øQu√© quer√©s descubrir hoy?</h2>

      <div class="ornament">‚ùß</div>

      <div class="category-cards">
        <div class="category-card" data-category="birds">
          <span class="category-icon">üê¶</span>
          <span class="category-label">Aves</span>
          <span class="category-sub">del Mundo</span>
        </div>

        <div class="category-card" data-category="birds-ar">
          <span class="category-icon">üá¶üá∑</span>
          <span class="category-label">Aves</span>
          <span class="category-sub">de Argentina</span>
        </div>

        <div class="category-card" data-category="trees">
          <span class="category-icon">üå≥</span>
          <span class="category-label">√Årboles</span>
          <span class="category-sub">del Mundo</span>
          <span class="music-hint">üéµ con m√∫sica</span>
        </div>
      </div>
    </section>

    <!-- ============ SCREEN 3: QUIZ ============ -->
    <section id="screen-quiz" class="screen">

      <!-- Top bar: Back + Progress -->
      <div class="quiz-top-bar">
        <button class="quit-btn" id="btn-quit" title="Volver al inicio">‚úï</button>
        <button class="music-mute-btn hidden" id="btn-music-mute" title="Silenciar/activar m√∫sica">üîä</button>
      </div>

      <!-- Progress -->
      <div class="progress-container">
        <span class="progress-text" id="progress-text">Ronda 1 / 10</span>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <span class="score-tracker" id="score-tracker">0 ‚úì</span>
      </div>

      <!-- Photo -->
      <div class="photo-container" id="photo-container">
        <div class="photo-placeholder" id="photo-placeholder">
          <span class="photo-placeholder-icon">üì∑</span>
          <span>Cargando imagen...</span>
        </div>
        <img id="quiz-photo" src="" alt="Especie a adivinar" style="opacity: 0;">
      </div>

      <!-- Bird sound (below photo) -->
      <div class="bird-sound-bar" id="bird-sound-bar" style="display:none;">
        <button class="sound-btn" id="btn-sound" title="Escuchar canto">
          <span id="sound-icon">üîä</span>
        </button>
        <span class="sound-label" id="sound-label">Toc√° para escuchar</span>
      </div>
      <audio id="bird-audio" preload="none"></audio>

      <!-- Question + Help -->
      <div class="question-row">
        <h3 class="question-text" id="question-text">¬øQu√© ave es esta?</h3>
        <button class="help-btn" id="btn-help" title="Eliminar una opci√≥n incorrecta">
          <span class="help-icon">üí°</span>
          <span class="help-label">Ayuda</span>
        </button>
      </div>

      <!-- Options -->
      <div class="options-grid" id="options-grid">
        <button class="option-btn" data-index="0">
          <span class="option-letter">A</span>
          <span class="option-content">
            <span class="option-name">Nombre</span>
            <span class="option-scientific">Nombre cient√≠fico</span>
          </span>
        </button>
        <button class="option-btn" data-index="1">
          <span class="option-letter">B</span>
          <span class="option-content">
            <span class="option-name">Nombre</span>
            <span class="option-scientific">Nombre cient√≠fico</span>
          </span>
        </button>
        <button class="option-btn" data-index="2">
          <span class="option-letter">C</span>
          <span class="option-content">
            <span class="option-name">Nombre</span>
            <span class="option-scientific">Nombre cient√≠fico</span>
          </span>
        </button>
        <button class="option-btn" data-index="3">
          <span class="option-letter">D</span>
          <span class="option-content">
            <span class="option-name">Nombre</span>
            <span class="option-scientific">Nombre cient√≠fico</span>
          </span>
        </button>
      </div>

      <!-- Reveal (hidden initially) -->
      <div class="reveal-section" id="reveal-section">
        <div class="fun-fact-card">
          <div class="fun-fact-species" id="reveal-species">Hornero</div>
          <div class="fun-fact-species-en" id="reveal-species-en">Rufous Hornero ¬∑ <em id="reveal-scientific">Furnarius rufus</em></div>
          <div class="fun-fact-text" id="reveal-fun-fact">Dato curioso aqu√≠</div>
        </div>
        <!-- Mini world map -->
        <div class="map-container" id="map-container">
          <div class="map-label">H√°bitat</div>
          <svg id="world-map" viewBox="0 0 360 180" class="world-map" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
      </div>

      <!-- Quote (hidden initially) -->
      <div class="quote-section" id="quote-section">
        <div class="quote-divider"></div>

        <div class="quote-block">
          <p class="quote-text" id="quote-text">Cita aqu√≠</p>
          <p class="quote-author" id="quote-author">‚Äî Autor</p>
        </div>

        <div class="next-section">
          <button class="btn btn-gold btn-block" id="btn-next">
            Siguiente ronda ‚Üí
          </button>
        </div>
      </div>

    </section>

    <!-- ============ SCREEN 4: RESULTS ============ -->
    <section id="screen-results" class="screen">

      <h2 class="results-header" id="results-header">Resultados</h2>

      <!-- Share card -->
      <div id="share-card">
        <div class="share-card-title">Pau's World of Wonder</div>
        <div class="share-card-category" id="results-category">Aves del Mundo</div>

        <div class="score-big" id="results-score">7 <span>/ 10</span></div>
        <div class="score-label">respuestas correctas</div>
        <div class="score-message" id="results-message">¬°Excelente!</div>

        <div class="results-divider"></div>
      </div>

      <!-- Action buttons -->
      <div class="results-actions">
        <div class="results-share-row">
          <button class="btn btn-primary" id="btn-share">
            <span class="share-icon">üì§</span> Compartir
          </button>
          <button class="btn btn-secondary" id="btn-download">
            <span class="share-icon">üíæ</span> Descargar
          </button>
        </div>
        <button class="btn btn-gold btn-block" id="btn-replay">
          üîÑ Jugar de nuevo
        </button>
      </div>

    </section>

    <!-- ============ SCREEN 5: REPORT ============ -->
    <section id="screen-report" class="screen">
      <h2 class="results-header" id="report-header">üîí Panel Admin</h2>

      <!-- Tab navigation -->
      <div class="report-tabs" id="report-tabs">
        <button class="report-tab active" data-tab="history">üìã Historial</button>
        <button class="report-tab" data-tab="stats">üìà Estad√≠sticas</button>
      </div>

      <!-- Tab: History -->
      <div id="tab-history" class="report-tab-content active">
        <div id="report-content" class="report-content">
          <p class="text-center" style="color:var(--text-light); font-style:italic;">No hay partidas registradas a√∫n.</p>
        </div>
      </div>

      <!-- Tab: Statistics -->
      <div id="tab-stats" class="report-tab-content">
        <div id="stats-content" class="report-content"></div>
      </div>

      <div class="results-actions mt-2">
        <button class="btn btn-primary btn-block" id="btn-report-back">
          ‚Üê Volver
        </button>
        <button class="btn btn-secondary btn-block mt-1" id="btn-report-clear" style="font-size:0.9rem;">
          üóëÔ∏è Borrar historial
        </button>
      </div>
    </section>

    <!-- ============ BACKGROUND MUSIC (trees quiz) ============ -->
    <audio id="bg-music" loop preload="none"></audio>

    <!-- ============ QUIT CONFIRMATION OVERLAY ============ -->
    <div class="quit-overlay" id="quit-overlay">
      <div class="quit-dialog">
        <div class="quit-icon">üö™</div>
        <h3 class="quit-title">¬øQuer√©s abandonar la partida?</h3>
        <p class="quit-text">Tu progreso actual se perder√°.</p>
        <div class="quit-actions">
          <button class="btn btn-primary" id="btn-quit-cancel">Seguir jugando</button>
          <button class="btn btn-secondary" id="btn-quit-confirm">S√≠, salir</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Offscreen canvas for share image generation -->
  <canvas id="share-canvas" width="1080" height="1350"></canvas>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="app.js"></script>
  <script>
    // Aggressive cache clean + SW update (v7)
    if ('serviceWorker' in navigator) {
      // Wipe all caches
      if ('caches' in window) {
        caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
      }
      // Unregister old SW, then re-register fresh
      navigator.serviceWorker.getRegistrations().then(regs => {
        regs.forEach(r => r.unregister());
        // Small delay to ensure unregister completes
        setTimeout(() => {
          navigator.serviceWorker.register('./sw.js').catch(() => {});
        }, 500);
      });
    }
  </script>
</body>
</html>
